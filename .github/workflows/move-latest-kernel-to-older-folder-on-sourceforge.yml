name: Move Latest Kernel to Older Folder on SourceForge

on:
  workflow_dispatch:

jobs:
  move-to-older:
    runs-on: ubuntu-latest
    
    steps:
      - name: Setup SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SF_GITHUB_ACTIONS }}" > ~/.ssh/sf_key
          chmod 600 ~/.ssh/sf_key
          ssh-keyscan -t rsa,ed25519 frs.sourceforge.net >> ~/.ssh/known_hosts

      - name: Download from Latest
        run: |
          mkdir -p downloads
          scp -i ~/.ssh/sf_key -r crystalforceix@frs.sourceforge.net:/home/frs/project/rengeos/RengeOS-Binary-Kernel/Latest/* downloads/

      - name: Upload to Older
        run: |
          for file in downloads/*; do
            [ -f "$file" ] && scp -i ~/.ssh/sf_key "$file" crystalforceix@frs.sourceforge.net:/home/frs/project/rengeos/RengeOS-Binary-Kernel/Older/
          done

      - name: Summary
        run: |
          echo "## Files Moved" >> $GITHUB_STEP_SUMMARY
          echo "### From Latest to Older:" >> $GITHUB_STEP_SUMMARY
          for file in downloads/*; do
            [ -f "$file" ] && echo "- $(basename "$file")" >> $GITHUB_STEP_SUMMARY
          done

      - name: Cleanup
        if: always()
        run: |
          rm -f ~/.ssh/sf_key
          rm -rf downloads
